"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0});var _react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_UIView2=require("../UIView"),_UIView3=_interopRequireDefault(_UIView2),_UISegmentedControl=require("../UISegmentedControl"),_UISegmentedControl2=_interopRequireDefault(_UISegmentedControl),_UIList=require("../UIList"),_UIList2=_interopRequireDefault(_UIList),_UIButton=require("../UIButton"),_UIButton2=_interopRequireDefault(_UIButton),_item=require("./item"),_item2=_interopRequireDefault(_item),_classnames=require("classnames"),_classnames2=_interopRequireDefault(_classnames),_noop=require("../UIUtils/noop"),_noop2=_interopRequireDefault(_noop),UIPaginatedView=function(_UIView){function UIPaginatedView(){return _classCallCheck(this,UIPaginatedView),_possibleConstructorReturn(this,Object.getPrototypeOf(UIPaginatedView).apply(this,arguments))}return _inherits(UIPaginatedView,_UIView),_createClass(UIPaginatedView,[{key:"initialState",value:function(){return{currentPage:this.props.pagerPosition,numberOfPages:Math.ceil(this.props.totalItems/this.props.numItemsPerPage),numItemsPerPage:this.props.numItemsPerPage,numPageToggles:this.props.numPageToggles,totalItems:this.props.totalItems,items:[{data:this.props.getItem(0)}],shownItems:[{data:this.props.getItem(0)}]}}},{key:"componentDidUpdate",value:function(oldProps,oldState){oldState.currentPage!==this.state.currentPage&&this.refs.itemList.refs.item_0.focus()}},{key:"componentDidMount",value:function(){this.setState({shownItems:this.generateItems(this.state.currentPage)})}},{key:"createPageButtonOptions",value:function(){var options=[],numberOfPages=this.state.numberOfPages,currentPage=this.state.currentPage,numPageToggles=this.props.numPageToggles,startPage=currentPage-(currentPage-1)%numPageToggles,endPage=Math.min(startPage+numPageToggles-1,numberOfPages);this.props.showJumpToFirst&&options.push({selected:!1,content:this.props.jumpToFirstControlText,value:UIPaginatedView.controlValues.FIRST,disabled:1===this.state.currentPage,className:"ui-paginated-view-controls-first"}),options.push({selected:!1,content:this.props.previousPageControlText,value:UIPaginatedView.controlValues.PREVIOUS,disabled:1===this.state.currentPage,className:"ui-paginated-view-controls-previous"});for(var i=startPage;endPage>=i;i++)options.push({selected:i===this.state.currentPage,content:i,value:i});return options.push({selected:!1,content:this.props.nextPageControlText,value:UIPaginatedView.controlValues.NEXT,disabled:this.state.currentPage===this.state.numberOfPages,className:"ui-paginated-view-controls-next"}),this.props.showJumpToLast&&options.push({selected:!1,content:this.props.jumpToLastControlText,value:UIPaginatedView.controlValues.LAST,disabled:this.state.currentPage===this.state.numberOfPages,className:"ui-paginated-view-controls-last"}),options}},{key:"currentPage",value:function(){return this.state.currentPage}},{key:"generateItems",value:function(currentPage){for(var generatedItems=[],firstItemIndex=(currentPage-1)*this.state.numItemsPerPage,lastItemIndex=Math.min(this.state.totalItems,firstItemIndex+this.state.numItemsPerPage)-1,i=firstItemIndex;lastItemIndex>=i;i++)generatedItems.push({data:this.props.getItem(i)});return generatedItems}},{key:"handleClick",value:function(value){var pageNumber=void 0;switch(value){case UIPaginatedView.controlValues.FIRST:pageNumber=1;break;case UIPaginatedView.controlValues.PREVIOUS:pageNumber=this.state.currentPage-1;break;case UIPaginatedView.controlValues.NEXT:pageNumber=this.state.currentPage+1;break;case UIPaginatedView.controlValues.LAST:pageNumber=this.state.numberOfPages;break;default:pageNumber=parseInt(value)}this.setState({currentPage:pageNumber,shownItems:this.generateItems(pageNumber)})}},{key:"renderControls",value:function(position){var _cx;return position=position.toLowerCase(),_react2.default.createElement(_UISegmentedControl2.default,_extends({},this.props.toggleWrapperProps,{ref:"segmentedControl"+(position[0].toUpperCase()+position.slice(1)),className:(0,_classnames2.default)((_cx={"ui-paginated-view-controls":!0},_defineProperty(_cx,"ui-paginated-view-controls-"+position,!0),_defineProperty(_cx,this.props.toggleWrapperProps.className,!!this.props.toggleWrapperProps.className),_cx)),options:this.createPageButtonOptions(),onOptionSelected:this.handleClick.bind(this)}))}},{key:"itemsToArray",value:function(){var items=[];return this.state.shownItems.map(function(item,index){items.push(_react2.default.createElement(_item2.default,{key:index,data:item.data,even:index%2===0}))}),items}},{key:"renderItems",value:function(){return _react2.default.createElement(_UIList2.default,_extends({},this.props.listWrapperProps,{ref:"itemList",className:(0,_classnames2.default)(_defineProperty({"ui-paginated-view-item-list":!0},this.props.listWrapperProps.className,!!this.props.listWrapperProps.className)),items:this.itemsToArray()}))}},{key:"renderView",value:function(){return _react2.default.createElement("div",{ref:"paginatedView",className:"ui-paginated-view"},this.props.position===UIPaginatedView.position.ABOVE||this.props.position===UIPaginatedView.position.BOTH?this.renderControls(UIPaginatedView.position.ABOVE):_noop2.default,this.renderItems(),this.props.position===UIPaginatedView.position.BELOW||this.props.position===UIPaginatedView.position.BOTH?this.renderControls(UIPaginatedView.position.BELOW):_noop2.default)}},{key:"render",value:function(){return _react2.default.createElement("div",_extends({},this.props,{ref:"wrapper",className:(0,_classnames2.default)(_defineProperty({"ui-paginated-view-wrapper":!0},this.props.className,!!this.props.className))}),this.renderView())}}]),UIPaginatedView}(_UIView3.default);UIPaginatedView.controlValues={FIRST:"FIRST",PREVIOUS:"PREVIOUS",NEXT:"NEXT",LAST:"LAST"},UIPaginatedView.position={ABOVE:"ABOVE",BELOW:"BELOW",BOTH:"BOTH"},UIPaginatedView.propTypes={getItem:_react2.default.PropTypes.func,jumpToFirstControlText:_react2.default.PropTypes.string,jumpToLastControlText:_react2.default.PropTypes.string,listWrapperProps:_react2.default.PropTypes.object,nextPageControlText:_react2.default.PropTypes.string,numItemsPerPage:function(props,propName,componentName){return Number.isInteger(props.numItemsPerPage)?props.numItemsPerPage<1||props.numItemsPerPage>props.totalItems?new Error("`numItemsPerPage` must be between 1 and "+props.totalItems+"."):void 0:new Error("`numItemsPerPage` must be an integer.")},numPageToggles:_react2.default.PropTypes.number,pagerPosition:function(props,propName,componentName){if(!Number.isInteger(props.pagerPosition))return new Error("`pagerPosition` must be an integer.");var numberOfPages=Math.ceil(props.totalItems/props.numItemsPerPage);return props.pagerPosition<1||props.pagerPosition>numberOfPages?new Error("`pagerPosition` must be between 1 and "+numberOfPages+"."):void 0},position:_react2.default.PropTypes.oneOf(Object.keys(UIPaginatedView.position)),previousPageControlText:_react2.default.PropTypes.string,showJumpToFirst:_react2.default.PropTypes.bool,showJumpToLast:_react2.default.PropTypes.bool,toggleWrapperProps:_react2.default.PropTypes.object,totalItems:_react2.default.PropTypes.number.isRequired},UIPaginatedView.defaultProps={options:[],getItem:_noop2.default,jumpToFirstControlText:"« First",jumpToLastControlText:"Last »",listWrapperProps:{},nextPageControlText:"Next ›",numItemsPerPage:10,numPageToggles:5,pagerPosition:1,position:UIPaginatedView.position.ABOVE,previousPageControlText:"‹ Previous",showJumpToFirst:!0,showJumpToLast:!0,toggleWrapperProps:{}},exports.default=UIPaginatedView;